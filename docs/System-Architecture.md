# System Architecture Document (SAD)

## GPU-Initiated IO Accelerator (gpuio)

**Version:** 1.0  
**Date:** 2026-02-09  
**Status:** Draft

---

## 1. Architecture Overview

### 1.1 Design Philosophy

gpuio follows a **layered, modular architecture** with clear separation of concerns:

1. **User Interface Layer** - Provides both transparent (on-demand) and explicit API access
2. **Core Engine Layer** - Manages IO scheduling, caching, and resource allocation
3. **Transport Abstraction Layer** - Abstracts MemIO, LocalIO, and RemoteIO operations
4. **Hardware Abstraction Layer** - Interfaces with GPU drivers, RDMA NICs, and NVMe controllers
5. **Kernel Driver Layer** - Kernel-space components for privileged operations

### 1.2 High-Level Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        User Application Layer                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐   │
│  │   Python    │  │    C/C++    │  │   CUDA C++  │  │  Other Langs    │   │
│  │   Binding   │  │    API      │  │   Operator  │  │   Bindings      │   │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └────────┬────────┘   │
└─────────┼────────────────┼────────────────┼─────────────────┼────────────┘
          │                │                │                 │
          └────────────────┴────────────────┴─────────────────┘
                                   │
┌──────────────────────────────────▼─────────────────────────────────────────┐
│                    User Interface Layer (User Space)                       │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                      Session Manager                                 │  │
│  │              (Context, Configuration, Security)                      │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│                                   │                                        │
│        ┌──────────────────────────┼──────────────────────────┐            │
│        ▼                          ▼                          ▼            │
│  ┌─────────────┐          ┌─────────────┐          ┌─────────────┐       │
│  │ On-Demand   │          │   Explicit  │          │    Batch    │       │
│  │   Proxy     │          │    API      │          │   Queue     │       │
│  │  (Lazy IO)  │          │ (Sync/Async)│          │  (Pipeline) │       │
│  └──────┬──────┘          └──────┬──────┘          └──────┬──────┘       │
└─────────┼────────────────────────┼─────────────────────────┼─────────────┘
          │                        │                         │
          └────────────────────────┴─────────────────────────┘
                                   │
┌──────────────────────────────────▼─────────────────────────────────────────┐
│                      Core Engine Layer (User Space)                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────┐ │
│  │   Metadata      │  │   Cache         │  │    Request Scheduler        │ │
│  │   Manager       │  │   Manager       │  │    (Work Queue)             │ │
│  │  (Namespace)    │  │ (Prefetch, Evict│  │  (Priority, Deadlines)      │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────────────────┘ │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────────────────┐ │
│  │   Memory        │  │   Resource      │  │    Fault Handler            │ │
│  │   Pool Manager  │  │   Tracker       │  │  (Page Fault, Retry)        │ │
│  │  (Pin/Unpin)    │  │  (GPU, Network) │  │                             │ │
│  └─────────────────┘  └─────────────────┘  └─────────────────────────────┘ │
└──────────────────────────────────┬─────────────────────────────────────────┘
                                   │
┌──────────────────────────────────▼─────────────────────────────────────────┐
│                  Transport Abstraction Layer                               │
│  ┌─────────────────────────────────────────────────────────────────────┐  │
│  │                    Transport Manager                                 │  │
│  │         (Route Selection, Load Balancing, Failover)                  │  │
│  └─────────────────────────────────────────────────────────────────────┘  │
│        │                    │                    │                        │
│        ▼                    ▼                    ▼                        │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                  │
│  │   MemIO     │     │   LocalIO   │     │   RemoteIO  │                  │
│  │  Transport  │     │  Transport  │     │  Transport  │                  │
│  │             │     │             │     │             │                  │
│  │ • Zero-copy │     │ • GDS       │     │ • Verbs     │                  │
│  │ • CXL.mem   │     │ • SPDK      │     │ • libfabric │                  │
│  │ • Unified  │     │ • io_uring  │     │ • UCX       │                  │
│  │   Memory   │     │ • DirectIO  │     │ • DDP       │                  │
│  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘                  │
└─────────┼───────────────────┼───────────────────┼─────────────────────────┘
          │                   │                   │
┌─────────┼───────────────────┼───────────────────┼─────────────────────────┐
│         ▼                   ▼                   ▼                         │
│    Hardware Abstraction Layer (User/Kernel Space)                        │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                  │
│  │  GPU Driver │     │  NVMe/SATA  │     │  RDMA Stack │                  │
│  │   (CUDA/    │     │   Driver    │     │   (Kernel   │                  │
│  │   ROCm/     │     │   Interface │     │   Drivers)  │                  │
│  │   Level0)   │     │             │     │             │                  │
│  └─────────────┘     └─────────────┘     └─────────────┘                  │
└────────────────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌────────────────────────────────────────────────────────────────────────────┐
│                           Hardware Layer                                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │  GPU 0  │  │  GPU 1  │  │  NVMe   │  │  NVMe   │  │  RDMA   │          │
│  │  HBM    │  │  HBM    │  │  SSD 0  │  │  SSD 1  │  │   NIC   │          │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     System Memory (DRAM)                            │   │
│  │              ┌─────────────────────────────────┐                   │   │
│  │              │    CXL Memory Pool (Optional)   │                   │   │
│  │              └─────────────────────────────────┘                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Component Architecture

### 2.1 User Interface Layer

#### 2.1.1 On-Demand Proxy (Transparent IO)

The On-Demand Proxy provides **lazy loading** semantics for data access:

```
┌─────────────────────────────────────────────────────────────┐
│                    On-Demand Proxy                           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  Operator   │  │   Memory    │  │    Prefetcher       │  │
│  │   Hook      │  │   Mapper    │  │   (Predictive)      │  │
│  │  (GPU/CPU)  │  │  (Virtual)  │  │                     │  │
│  └──────┬──────┘  └──────┬──────┘  └─────────────────────┘  │
│         │                │                                   │
│         └────────────────┼─────────────────┐                 │
│                          ▼                 ▼                 │
│                   ┌─────────────┐   ┌─────────────┐          │
│                   │ Page Fault  │   │   Cache     │          │
│                   │   Handler   │   │   Index     │          │
│                   └──────┬──────┘   └──────┬──────┘          │
│                          └─────────────────┘                 │
└─────────────────────────────────────────────────────────────┘
```

**Key Components:**
- **Operator Hook**: Intercepts array indexing operations using CUDA device functions or C++ proxy objects
- **Memory Mapper**: Manages virtual address space mapping to physical GPU memory
- **Page Fault Handler**: Triggers data fetch on access to unmapped regions
- **Prefetcher**: Predicts and pre-loads data based on access patterns

#### 2.1.2 Explicit API (Programmatic IO)

```
┌─────────────────────────────────────────────────────────────┐
│                      Explicit API                            │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────────────────┐  │
│  │                  Request Builder                       │  │
│  │  (Source, Destination, Size, Flags, Callback)         │  │
│  └─────────────────────────┬─────────────────────────────┘  │
│                            │                                 │
│         ┌──────────────────┼──────────────────┐              │
│         ▼                  ▼                  ▼              │
│  ┌─────────────┐   ┌─────────────┐   ┌─────────────┐        │
│  │   Sync      │   │   Async     │   │   Batch     │        │
│  │   Submit    │   │   Submit    │   │   Submit    │        │
│  │ (Blocking)  │   │(Non-blocking│   │ (Multiple)  │        │
│  └─────────────┘   └─────────────┘   └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 Core Engine Layer

#### 2.2.1 Request Scheduler

The scheduler implements **multi-queue, priority-based** dispatch:

```
┌─────────────────────────────────────────────────────────────┐
│                   Request Scheduler                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Incoming Requests ──► ┌─────────────────────────────┐      │
│                        │   Priority Queue (RB-Tree)  │      │
│                        │   - Deadline-aware           │      │
│                        │   - Fairness (CFS-like)      │      │
│                        └──────────────┬──────────────┘      │
│                                       │                     │
│    ┌──────────────────────────────────┼──────────────────┐  │
│    ▼                                  ▼                  ▼  │
│ ┌─────────┐  ┌─────────┐  ┌─────────┐ ┌─────────┐  ┌────────┐│
│ │MemIO Q  │  │LocalIO Q│  │RemoteIO │ │Deadline │  │Batch Q ││
│ │(High BW)│  │(Medium) │  │  Q      │ │   Q     │  │        ││
│ └────┬────┘  └────┬────┘  └────┬────┘ └────┬────┘  └───┬────┘│
│      └─────────────┴────────────┴───────────┴───────────┘     │
│                         │                                     │
│                         ▼                                     │
│              ┌──────────────────────┐                        │
│              │   Work Distributor   │                        │
│              │ (GPU Stream Assign)  │                        │
│              └──────────────────────┘                        │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2.2 Cache Manager

Multi-level caching architecture:

```
┌─────────────────────────────────────────────────────────────┐
│                     Cache Manager                            │
├─────────────────────────────────────────────────────────────┤
│  L1: GPU Device Cache (HBM)                                  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  • Direct-mapped / Set-associative                   │  │
│  │  • LRU eviction policy                               │  │
│  │  • Hardware-managed coherency                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                           │                                 │
│  L2: Host Cache (DRAM)                                     │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  • Software-managed                                  │  │
│  │  • Compressed data format                            │  │
│  │  • Pinned memory for zero-copy                       │  │
│  └───────────────────────────────────────────────────────┘  │
│                           │                                 │
│  L3: Storage Cache (NVMe/SATA)                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  • Block-based caching                               │  │
│  │  • Write-through / Write-back modes                  │  │
│  │  • Local SSD as extension                            │  │
│  └───────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 Transport Layer

#### 2.3.1 MemIO Transport

```
┌─────────────────────────────────────────────────────────────┐
│                      MemIO Transport                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Zero-Copy   │  │   CXL.mem    │  │   Unified    │      │
│  │   Path       │  │   Access     │  │   Memory     │      │
│  │ (CUDA/ROCm)  │  │ (Load/Store) │  │   (UM)       │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
│         │                 │                 │               │
│         └─────────────────┴─────────────────┘               │
│                           │                                 │
│                    ┌──────┴──────┐                         │
│                    │  NUMA Aware │                         │
│                    │   Router    │                         │
│                    └──────┬──────┘                         │
│                           │                                 │
│         ┌─────────────────┼─────────────────┐               │
│         ▼                 ▼                 ▼               │
│    ┌─────────┐      ┌─────────┐      ┌─────────┐           │
│    │ GPU HBM │      │Host DRAM│      │CXL Mem  │           │
│    └─────────┘      └─────────┘      └─────────┘           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 2.3.2 LocalIO Transport

```
┌─────────────────────────────────────────────────────────────┐
│                     LocalIO Transport                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │              GPUDirect Storage (GDS)                   ││
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   ││
│  │  │cuFile   │  │  DMA    │  │   NVMe  │  │ Checksum│   ││
│  │  │  API    │  │  Engine │  │  Queue  │  │ Engine  │   ││
│  │  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘   ││
│  └───────┼────────────┼────────────┼────────────┼────────┘│
│          │            │            │            │         │
│  ┌───────┴────────────┴────────────┴────────────┴────────┐│
│  │                    SPDK Integration                    ││
│  │  (Userspace NVMe driver for kernel bypass)             ││
│  └────────────────────────────────────────────────────────┘│
│                                                             │
│  Compression/Encryption Modules (Optional):                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   LZ4       │  │   ZSTD      │  │    AES      │         │
│  │ (Fast)      │  │(Balanced)   │  │(Encryption) │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 2.3.3 RemoteIO Transport

```
┌─────────────────────────────────────────────────────────────┐
│                     RemoteIO Transport                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                   Transport Abstraction                  ││
│  │  ┌─────────┐  ┌───────────┐  ┌─────────┐  ┌────────┐  ││
│  │  │  Verbs  │  │libfabric  │  │   UCX   │  │ Custom │  ││
│  │  │(Legacy) │  │  (Modern) │  │(Unified)│  │  DDP   │  ││
│  │  └────┬────┘  └─────┬─────┘  └────┬────┘  └───┬────┘  ││
│  └───────┼─────────────┼─────────────┼───────────┼───────┘│
│          │             │             │           │        │
│  ┌───────┴─────────────┴─────────────┴───────────┴───────┐│
│  │              Connection Manager                        ││
│  │  • Pool of pre-connected peers                        ││
│  │  • Connection multiplexing                            ││
│  │  • Reconnection on failure                            ││
│  └────────────────────────────────────────────────────────┘│
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │               RDMA Operation Types                      ││
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   ││
│  │  │  READ   │  │  WRITE  │  │  ATOMIC │  │   SEND  │   ││
│  │  │ (Pull)  │  │ (Push)  │  │ (CAS/FAA│  │/RECV    │   ││
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘   ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
│  GPU-Direct RDMA:                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ GPU Memory   │  │  BAR Region  │  │   NIC DMA    │      │
│  │ Registration │──►│   Mapping    │──►│   Engine     │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. Data Flow Architecture

### 3.1 On-Demand Access Flow

```
GPU Kernel                      gpuio Runtime                      Source
   │                                 │                              │
   │ 1. Access data[i]               │                              │
   ├────────────────────────────────►│                              │
   │                                 │                              │
   │ 2. Page Fault (GPU trap)        │                              │
   │◄────────────────────────────────┤                              │
   │                                 │                              │
   │                                 │ 3. Lookup cache               │
   │                                 │ (Miss)                       │
   │                                 │                              │
   │                                 │ 4. Allocate GPU memory        │
   │                                 │                              │
   │                                 │ 5. Submit IO request          │
   │                                 ├─────────────────────────────►│
   │                                 │                              │
   │                                 │ 6. Data transfer             │
   │                                 │◄─────────────────────────────┤
   │                                 │                              │
   │                                 │ 7. Update page table          │
   │                                 │                              │
   │ 8. Resume kernel                │                              │
   │◄────────────────────────────────┤                              │
   │                                 │                              │
```

### 3.2 Explicit Transfer Flow

```
Application                     gpuio Runtime                      Destination
   │                                 │                                │
   │ 1. Submit transfer request      │                                │
   ├────────────────────────────────►│                                │
   │   (src, dst, size, callback)    │                                │
   │                                 │                                │
   │                                 │ 2. Validate & queue request     │
   │                                 │                                │
   │                                 │ 3. Memory registration          │
   │                                 │ (if needed)                    │
   │                                 │                                │
   │                                 │ 4. Route to transport layer     │
   │                                 │                                │
   │                                 │ 5. Execute transfer            │
   │                                 ├───────────────────────────────►│
   │                                 │                                │
   │                                 │ 6. Completion notification     │
   │                                 │◄───────────────────────────────┤
   │                                 │                                │
   │ 7. Invoke callback              │                                │
   │◄────────────────────────────────┤                                │
   │                                 │                                │
```

### 3.3 Multi-Transport Flow

```
                    ┌─────────────────────┐
                    │   IO Request        │
                    │   (URI-based)       │
                    └─────────┬───────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │   URI Parser        │
                    │   mem://, nvme://,  │
                    │   rdma://, file://   │
                    └─────────┬───────────┘
                              │
            ┌─────────────────┼─────────────────┐
            ▼                 ▼                 ▼
    ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
    │   mem://      │ │   nvme://     │ │   rdma://     │
    │   MemIO       │ │   LocalIO     │ │   RemoteIO    │
    │   Handler     │ │   Handler     │ │   Handler     │
    └───────┬───────┘ └───────┬───────┘ └───────┬───────┘
            │                 │                 │
            ▼                 ▼                 ▼
    ┌───────────────┐ ┌───────────────┐ ┌───────────────┐
    │  Zero-copy    │ │  GPUDirect    │ │  RDMA READ/   │
    │  load/store   │ │  Storage      │ │  WRITE        │
    └───────────────┘ └───────────────┘ └───────────────┘
```

---

## 4. Threading and Concurrency Model

### 4.1 GPU-Side Execution

```
┌─────────────────────────────────────────────────────────────┐
│                      GPU Execution Model                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │              Compute Kernel (User Code)                │  │
│  │                                                       │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐               │  │
│  │  │ Thread  │  │ Thread  │  │ Thread  │  ...          │  │
│  │  │  Block  │  │  Block  │  │  Block  │               │  │
│  │  │   0     │  │   1     │  │   N     │               │  │
│  │  └────┬────┘  └────┬────┘  └────┬────┘               │  │
│  │       │            │            │                     │  │
│  │       └────────────┴────────────┘                     │  │
│  │                    │                                  │  │
│  │                    ▼                                  │  │
│  │         ┌───────────────────┐                         │  │
│  │         │  gpuio Device     │                         │  │
│  │         │  Functions        │                         │  │
│  │         │  (Inline Assembly)│                         │  │
│  │         └───────────────────┘                         │  │
│  └───────────────────────────────────────────────────────┘  │
│                           │                                 │
│                           ▼                                 │
│  ┌───────────────────────────────────────────────────────┐  │
│  │              GPU Hardware Queues                      │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐               │  │
│  │  │  Copy   │  │ Compute │  │  Copy   │               │  │
│  │  │ Engine 0│  │ Engine  │  │ Engine 1│               │  │
│  │  └─────────┘  └─────────┘  └─────────┘               │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 Host-Side Threading

```
┌─────────────────────────────────────────────────────────────┐
│                     Host Threading Model                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Main Thread │  │ Worker Pool  │  │   Event      │      │
│  │  (API Calls) │  │ (IO Workers) │  │   Thread     │      │
│  │              │  │              │  │ (Completion) │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
│         │                 │                 │               │
│         └─────────────────┼─────────────────┘               │
│                           │                                 │
│                    ┌──────┴──────┐                         │
│                    │  Work Queue │                         │
│                    │ (Lock-free) │                         │
│                    └─────────────┘                         │
│                                                             │
│  Worker Thread Architecture:                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   MemIO     │  │   LocalIO   │  │   RemoteIO  │         │
│  │   Worker    │  │   Worker    │  │   Worker    │         │
│  │  (per-GPU)  │  │  (per-NVMe) │  │  (per-NIC)  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. Memory Architecture

### 5.1 Memory Hierarchy

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Memory Hierarchy                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Capacity ▲                                                                  │
│     ↑     │                                    ┌──────────────┐             │
│     │     │  Network Storage                    │   Cloud      │ PB+ Scale   │
│     │     │  (S3, GCS, Azure)                   │   Storage    │             │
│     │     │                                    └──────────────┘             │
│     │     │                                          ▲                       │
│     │     │                                    ┌─────┴─────┐                 │
│     │     │  Remote Node Memory                 │   RDMA    │ 100GB/s        │
│     │     │                                    │  Network  │                │
│     │     │                                    └─────┬─────┘                │
│     │     │                                          ▼                       │
│     │     │                                    ┌──────────────┐             │
│     │     │  Local NVMe Storage                 │  NVMe Array  │ 50+ GB/s     │
│     │     │  (RAID 0/1/10)                     │  (Multiple)  │              │
│     │     │                                    └──────────────┘             │
│     │     │                                          ▲                       │
│     │     │                                          │                       │
│     │     │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│     │     │  │   GPU HBM    │◄─┤ PCIe/CXL Bus │─►│  Host DRAM   │           │
│     │     │  │   (HBM3)     │  │  (128GB/s)   │  │  (DDR5)      │           │
│     │     │  │  3+ TB/s     │  │              │  │  200 GB/s    │           │
│     │     │  └──────────────┘  └──────────────┘  └──────────────┘           │
│     │     │         ▲                ▲                ▲                      │
│     │     │         └────────────────┴────────────────┘                      │
│     │     │                         │                                        │
│     │     │                   ┌─────┴─────┐                                  │
│     │     │                   │  GPU L2   │                                  │
│     │     │                   │   Cache   │                                  │
│     │     │                   └─────┬─────┘                                  │
│     │     │                         │                                        │
│     │     │                   ┌─────┴─────┐                                  │
│     │     │                   │  SM L1    │                                  │
│     │     │                   │   Cache   │                                  │
│     │     │                   └─────┬─────┘                                  │
│     │     │                         │                                        │
│     │     └─────────────────────────┼────────────────────────────────────────│
│     │                               │                                        │
│     └───────────────────────────────┘                                        │
│                            Registers                                         │
│                                                                              │
│  Latency:  1ns ◄─────────────────────────────────────────────────► 1s+       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 Address Space Mapping

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Virtual Address Space                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  GPU Virtual Address Space                                                   │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ 0x0000_0000_0000_0000                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  Local GPU HBM  │  Mapped Physical GPU Memory                    │ │
│  │     │   (Allocated)   │                                                │ │
│  │     └─────────────────┘                                                │ │
│  │ 0x0000_7FFF_FFFF_FFFF                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  gpuio Window   │  On-Demand Mapped Region                        │ │
│  │     │  (Transparent)  │  → Points to Cache or Triggers Fault Handler   │ │
│  │     └─────────────────┘                                                │ │
│  │ 0x0001_0000_0000_0000                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  Peer GPU HBM   │  P2P Access to other GPUs                      │ │
│  │     │   (UVA Mapping) │                                                │ │
│  │     └─────────────────┘                                                │ │
│  │ 0x0002_0000_0000_0000                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  System Memory  │  CPU DRAM (via PCIe BAR or CXL)                │ │
│  │     │  (Pinned/UM)    │                                                │ │
│  │     └─────────────────┘                                                │ │
│  │ 0x0003_0000_0000_0000                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  CXL Memory     │  CXL 2.0/3.0 Memory Pool                       │ │
│  │     │   (Type 3)      │                                                │ │
│  │     └─────────────────┘                                                │ │
│  │ 0x0004_0000_0000_0000                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  NVMe BAR       │  Memory-mapped NVMe doorbells                  │ │
│  │     │  (MMIO)         │                                                │ │
│  │     └─────────────────┘                                                │ │
│  │ 0x0005_0000_0000_0000                                                  │ │
│  │     ┌─────────────────┐                                                │ │
│  │     │  NIC BAR        │  RDMA NIC Memory Region                        │ │
│  │     │  (GPUDirect)    │                                                │ │
│  │     └─────────────────┘                                                │ │
│  │ 0xFFFF_FFFF_FFFF_FFFF                                                  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 6. Deployment Architecture

### 6.1 Single Node

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Single Node Configuration                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                              CPU (Host)                                │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │ │
│  │  │   gpuio     │  │   gpuio     │  │    OS       │  │   User      │   │ │
│  │  │   Daemon    │  │   Library   │  │   Kernel    │  │  Apps       │   │ │
│  │  │  (Optional) │  │  (Linked)   │  │             │  │             │   │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                     │                                        │
│                              PCIe Switch / CXL                              │
│                                     │                                        │
│  ┌──────────────────────────────────┼────────────────────────────────────┐  │
│  │                                  ▼                                    │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐   │  │
│  │  │  GPU 0  │  │  GPU 1  │  │  GPU 2  │  │  GPU 3  │  │  NIC    │   │  │
│  │  │ (H100)  │  │ (H100)  │  │ (H100)  │  │ (H100)  │  │(CX-7)   │   │  │
│  │  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘   │  │
│  │       │            │            │            │            │        │  │
│  │       └────────────┴────────────┴────────────┘            │        │  │
│  │                          │                                │        │  │
│  │                    NVLink/NVSwitch                        │        │  │
│  │                    (Optional P2P)                         │        │  │
│  │                                                          │        │  │
│  │       ┌─────────┐  ┌─────────┐  ┌─────────┐              │        │  │
│  │       │  NVMe 0 │  │  NVMe 1 │  │  NVMe 2 │              │        │  │
│  │       │  (Gen5) │  │  (Gen5) │  │  (Gen5) │              │        │  │
│  │       └─────────┘  └─────────┘  └─────────┘              │        │  │
│  │                                                          │        │  │
│  │       ┌─────────────────────────────────────┐            │        │  │
│  │       │      CXL Memory Expander            │◄───────────┘        │  │
│  │       │    (Shared Memory Pool)             │                     │  │
│  │       └─────────────────────────────────────┘                     │  │
│  │                                                                   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 6.2 Multi-Node Cluster

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Multi-Node Cluster Configuration                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                            InfiniBand / RoCE                            ││
│  │                          Network Fabric                                 ││
│  │  ┌──────────────┬──────────────┬──────────────┬──────────────┐         ││
│  │  │   Switch 0   │   Switch 1   │     ...      │  Switch N    │         ││
│  │  └──────┬───────┴──────┬───────┴──────┬───────┴──────┬───────┘         ││
│  │         │              │              │              │                 ││
│  └─────────┼──────────────┼──────────────┼──────────────┼─────────────────┘│
│            │              │              │              │                  │
│  ┌─────────┴──────┐ ┌─────┴──────────┐ ┌─┴────────────┐ ┌┴───────────────┐ │
│  │   Node 0       │ │    Node 1      │ │   Node 2     │ │    Node N      │ │
│  │ ┌────────────┐ │ │ ┌────────────┐ │ │ ┌──────────┐ │ │ ┌────────────┐ │ │
│  │ │ 8x GPU     │ │ │ │ 8x GPU     │ │ │ │ 8x GPU   │ │ │ │ 8x GPU     │ │ │
│  │ │ gpuio Agent│ │ │ │ gpuio Agent│ │ │ │gpuio Agent│ │ │ │ gpuio Agent│ │ │
│  │ └────────────┘ │ │ └────────────┘ │ │ └──────────┘ │ │ └────────────┘ │ │
│  │ ┌────────────┐ │ │ ┌────────────┐ │ │ ┌──────────┐ │ │ ┌────────────┐ │ │
│  │ │ 2x NIC     │─┼─┼►│ 2x NIC     │─┼─┼►│ 2x NIC   │─┼─┼►│ 2x NIC     │ │ │
│  │ │ (HDR200)   │ │ │ │ (HDR200)   │ │ │ │ (HDR200) │ │ │ │ (HDR200)   │ │ │
│  │ └────────────┘ │ │ └────────────┘ │ │ └──────────┘ │ │ └────────────┘ │ │
│  │ ┌────────────┐ │ │ ┌────────────┐ │ │ ┌──────────┐ │ │ ┌────────────┐ │ │
│  │ │ Local NVMe │ │ │ │ Local NVMe │ │ │ │Local NVMe│ │ │ │ Local NVMe │ │ │
│  │ │ (RAID)     │ │ │ │ (RAID)     │ │ │ │(RAID)    │ │ │ │ (RAID)     │ │ │
│  │ └────────────┘ │ │ └────────────┘ │ │ └──────────┘ │ │ └────────────┘ │ │
│  └────────────────┘ └────────────────┘ └──────────────┘ └────────────────┘ │
│                                                                              │
│  Metadata Service (Optional):                                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  ││
│  │  │   etcd /     │  │   ZooKeeper  │  │    Custom    │                  ││
│  │  │  Consul      │  │              │  │   Registry   │                  ││
│  │  └──────────────┘  └──────────────┘  └──────────────┘                  ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Security Architecture

### 7.1 Security Layers

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        Security Architecture                                 │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Layer 5: Application                                                        │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ • API Key Authentication • Role-Based Access Control                  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Layer 4: Transport                                                          │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ • TLS/SSL for Remote IO • RDMA with PSK • Certificate Management      │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Layer 3: Network                                                            │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ • Firewall Rules • VLAN Isolation • Subnet Access Control             │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Layer 2: Memory                                                             │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ • Process Isolation • Capability-based Access • Memory Protection     │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  Layer 1: Hardware                                                           │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │ • SR-IOV • Trusted Execution • Secure Boot • Device Authentication    │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 8. Monitoring and Observability

### 8.1 Metrics Collection

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Observability Stack                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                        Metrics Sources                                 │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐         │ │
│  │  │ GPU HW  │ │ NVMe    │ │ NIC     │ │ gpuio   │ │ OS      │         │ │
│  │  │Counters │ │ SMART   │ │ Counters│ │Events   │ │Stats    │         │ │
│  │  └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘         │ │
│  │       └───────────┴───────────┴───────────┴───────────┘              │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│                                    ▼                                         │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                    Metrics Aggregation                                 │ │
│  │  • Prometheus/Grafana • Custom Time-Series DB • StatsD                │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│                    ┌───────────────┼───────────────┐                         │
│                    ▼               ▼               ▼                         │
│  ┌───────────────────────┐ ┌───────────────┐ ┌───────────────────────┐     │
│  │   Performance Metrics │ │ Health Metrics│ │   Debug/Diagnostics   │     │
│  │  - Throughput         │ │ - Error Rates │ │ - Traces              │     │
│  │  - Latency (p50/p99)  │ │ - Queue Depth │ │ - Logs                │     │
│  │  - Bandwidth Util     │ │ - Resource Use│ │ - Profiling           │     │
│  └───────────────────────┘ └───────────────┘ └───────────────────────┘     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 9. Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-02-09 | gpuio Team | Initial architecture |
